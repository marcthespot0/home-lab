---
kind: Namespace
apiVersion: v1
metadata:
  name: glance
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: glance
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "-1"
spec:
  project: default
  source:
    chart: app-template
    repoURL: http://bjw-s.github.io/helm-charts/
    targetRevision: 3.7.3
    helm:
      values: |
        # fullnameOverride: *name
        # defaultPodOptions:
        #   securityContext:
        #     runAsNonRoot: true
        #     runAsUser: 1022
        #     runAsGroup: 1022
        #     fsGroup: 1022
        #     fsGroupChangePolicy: OnRootMismatch
        #     seccompProfile:
        #       type: RuntimeDefault
        controllers:
          glance:
            strategy: RollingUpdate
            annotations:
              reloader.stakater.com/auto: "true"
            containers:
              glance:
                image:
                  repository: glanceapp/glance
                  tag: v0.7.3@sha256:ecf8c49224cff1264fc028eea9a91cd8fb5aab39ab75c0bebd30235ef42d0cab
                args:
                  - --config
                  - /config/glance.yaml
                env:
                  TZ: "${TIMEZONE}"
                securityContext:
                  allowPrivilegeEscalation: false
                  readOnlyRootFilesystem: true
                  capabilities: { drop: ["ALL"] }
        # service:
        #   glance:
        #     controller: *name
        #     ports:
        #       http:
        #         port: 8080
        #     hosts:
        #       - host: &host "glance.${SECRET_DEFAULT_DOMAIN}"
        #         paths:
        #           - path: /
        #             service:
        #               identifier: glance
        #               port: http
        #     tls:
        #       - hosts:
        #           - *host
        persistence:
          config:
            enabled: true
            type: configMap
            name: glance-configmap
  destination:
    server: https://kubernetes.default.svc
    namespace: glance
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: glance-configmap
  namespace: glance
  labels:
    app.kubernetes.io/name: glance
data:
  glance.yaml: |
    theme:
      background-color: 240 21 15
      contrast-multiplier: 1.2
      primary-color: 217 92 83
      positive-color: 115 54 76
      negative-color: 347 70 65
    pages:
      - name: Home
        columns:
          - size: small
            widgets:
              - type: calendar

              - type: rss
                limit: 10
                collapse-after: 3
                cache: 3h
                feeds:
                  - url: https://ciechanow.ski/atom.xml
                  - url: https://www.joshwcomeau.com/rss.xml
                    title: Josh Comeau
                  - url: https://samwho.dev/rss.xml
                  - url: https://awesomekling.github.io/feed.xml
                  - url: https://ishadeed.com/feed.xml
                    title: Ahmad Shadeed

              - type: twitch-channels
                channels:
                  - ferretsoftware
                  - theprimeagen
                  - cohhcarnage
                  - christitustech
                  - blurbs
                  - asmongold
                  - jembawls

          - size: full
            widgets:
              - type: hacker-news

              - type: videos
                channels:
                  - UCR-DXc1voovS8nhAvccRZhg # Jeff Geerling
                  - UCv6J_jJa8GJqFwQNgNrMuww # ServeTheHome
                  - UCOk-gHyjcWZNj3Br4oxwh0A # Techno Tim

              - type: reddit
                subreddit: selfhosted

          - size: small
            widgets:
              - type: weather
                location: Eugene, Oregon, United States

              - type: monitor
                cache: 1m
                title: Services
                sites:
                  - title: Home Assistant
                    url: https://hass.ok8.sh
                  - title: Grafana
                    url: https://grafana.ok8.sh
                  - title: ID
                    url: https://id.ok8.sh
                  - title: DynMC
                    url: https://dynmc.ok8.sh